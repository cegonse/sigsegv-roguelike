const jsonObject = require("../src/json-object")

describe("Packing JSON object files", () => {
  // XX XX XX XX Number of entries (LE UINT32)
  // XX XX XX XX Total length (LE UINT32)
  // For each string entry
  // 01 00 00 00 Entry type (STRING)
  // XX XX XX XX Key length (LE UINT32)
  // [XX]        Non-null terminated key string in ASCII
  // XX XX XX XX Value length (LE UINT32)
  // [XX]        Non-null terminated value string in ASCII
  it("may include one string", () => {
    const json = {
      "hello": "world"
    }
    const buffer = jsonObject.encode(json)
  
    expect([...buffer]).toEqual([
      0x01, 0x00, 0x00, 0x00,
      0x16, 0x00, 0x00, 0x00,
      0x01, 0x00, 0x00, 0x00,
      0x05, 0x00, 0x00, 0x00,
      0x68, 0x65, 0x6C, 0x6C, 0x6F,
      0x05, 0x00, 0x00, 0x00,
      0x77, 0x6F, 0x72, 0x6C, 0x64
    ])
  })

  it("may include many strings", () => {
    const json = {
      "first": "hello",
      "second": "bye"
    }
    const buffer = jsonObject.encode(json)
  
    expect([...buffer]).toEqual([
      0x02, 0x00, 0x00, 0x00,
      0x2B, 0x00, 0x00, 0x00,
      0x01, 0x00, 0x00, 0x00,
      0x05, 0x00, 0x00, 0x00,
      0x66, 0x69, 0x72, 0x73, 0x74,
      0x05, 0x00, 0x00, 0x00,
      0x68, 0x65, 0x6C, 0x6C, 0x6F,
      0x01, 0x00, 0x00, 0x00,
      0x06, 0x00, 0x00, 0x00,
      0x73, 0x65, 0x63, 0x6F, 0x6E, 0x64,
      0x03, 0x00, 0x00, 0x00,
      0x62, 0x79, 0x65
    ])
  })

  // For each number entry
  // 02 00 00 00 Entry type (NUMBER)
  // XX XX XX XX Key length (LE UINT32)
  // [XX]        Non-null terminated key string in ASCII
  // XX XX XX XX Value (LE Float)
  it("may include numeric values", () => {
    const json = {
      "hello": 1.5
    }
    const buffer = jsonObject.encode(json)
  
    expect([...buffer]).toEqual([
      0x01, 0x00, 0x00, 0x00,
      0x11, 0x00, 0x00, 0x00,
      0x02, 0x00, 0x00, 0x00,
      0x05, 0x00, 0x00, 0x00,
      0x68, 0x65, 0x6C, 0x6C, 0x6F,
      0x00, 0x00, 0xC0, 0x3F
    ])
  })

  it("may include numeric and string values", () => {
    const json = {
      "hello": 2.1,
      "world": "bye"
    }
    const buffer = jsonObject.encode(json)
  
    expect([...buffer]).toEqual([
      0x02, 0x00, 0x00, 0x00,
      0x25, 0x00, 0x00, 0x00,
      0x02, 0x00, 0x00, 0x00,
      0x05, 0x00, 0x00, 0x00,
      0x68, 0x65, 0x6C, 0x6C, 0x6F,
      0x66, 0x66, 0x06, 0x40,
      0x01, 0x00, 0x00, 0x00,
      0x05, 0x00, 0x00, 0x00,
      0x77, 0x6F, 0x72, 0x6C, 0x64,
      0x03, 0x00, 0x00, 0x00,
      0x62, 0x79, 0x65
    ])
  })
})
